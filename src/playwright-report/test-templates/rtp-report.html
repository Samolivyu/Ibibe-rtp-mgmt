<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTP Test Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px;
        }
        .stat-card { 
            background: white; 
            border-radius: 8px; 
            padding: 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-value { 
            font-size: 2.5rem; 
            font-weight: bold; 
            margin: 10px 0;
        }
        .compliance-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
        }
        .compliance-pass { background: var(--success); color: white; }
        .compliance-fail { background: var(--danger); color: white; }
        .chart-container { 
            background: white; 
            border-radius: 8px; 
            padding: 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .results-table th, .results-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .results-table th {
            background-color: var(--primary);
            color: white;
        }
        .results-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>RTP Compliance Test Report</h1>
            <p>Generated on: {{GENERATION_DATE}}</p>
            <p>Total Tests: {{TOTAL_TESTS}}</p>
        </div>

        <div class="stats-grid" id="summary-stats">
            <!-- Filled by JavaScript -->
        </div>

        <div class="chart-container">
            <canvas id="rtp-distribution-chart"></canvas>
        </div>

        <div class="chart-container">
            <canvas id="variance-chart"></canvas>
        </div>

        <div class="chart-container">
            <h2>Test Results</h2>
            <table class="results-table" id="results-table">
                <thead>
                    <tr>
                        <th>Game ID</th>
                        <th>Expected RTP</th>
                        <th>Actual RTP</th>
                        <th>Variance</th>
                        <th>Spins</th>
                        <th>Compliance</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Filled by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Results injected by the reporter
        /* INSERT_RESULTS */
        
        // Calculate summary statistics
        function calculateSummary() {
            const summary = {
                totalTests: rtpResults.length,
                compliantTests: 0,
                nonCompliantTests: 0,
                avgVariance: 0,
                minRTP: 100,
                maxRTP: 0
            };
            
            let varianceSum = 0;
            
            rtpResults.forEach(result => {
                if (result.isCompliant) summary.compliantTests++;
                else summary.nonCompliantTests++;
                
                varianceSum += Math.abs(result.variance);
                
                if (result.actualRTP < summary.minRTP) summary.minRTP = result.actualRTP;
                if (result.actualRTP > summary.maxRTP) summary.maxRTP = result.actualRTP;
            });
            
            summary.avgVariance = (varianceSum / rtpResults.length).toFixed(2);
            summary.complianceRate = ((summary.compliantTests / rtpResults.length) * 100).toFixed(1);
            
            return summary;
        }
        
        // Render summary stats
        function renderSummary(summary) {
            const container = document.getElementById('summary-stats');
            
            container.innerHTML = `
                <div class="stat-card">
                    <h3>Compliance Rate</h3>
                    <div class="stat-value">${summary.complianceRate}%</div>
                    <div>${summary.compliantTests} of ${summary.totalTests} tests</div>
                </div>
                <div class="stat-card">
                    <h3>Average Variance</h3>
                    <div class="stat-value">${summary.avgVariance}%</div>
                    <div>Across all tests</div>
                </div>
                <div class="stat-card">
                    <h3>RTP Range</h3>
                    <div class="stat-value">${summary.minRTP.toFixed(2)}% - ${summary.maxRTP.toFixed(2)}%</div>
                    <div>Observed range</div>
                </div>
            `;
        }
        
        // Render RTP distribution chart
        function renderRTPDistribution() {
            const rtpValues = rtpResults.map(r => r.actualRTP);
            const ctx = document.getElementById('rtp-distribution-chart').getContext('2d');
            
            new Chart(ctx, {
                type: 'histogram',
                data: {
                    datasets: [{
                        label: 'RTP Distribution',
                        data: rtpValues,
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        x: {
                            title: { display: true, text: 'RTP Percentage' },
                            min: Math.min(...rtpValues) - 5,
                            max: Math.max(...rtpValues) + 5
                        },
                        y: {
                            title: { display: true, text: 'Frequency' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Render variance chart
        function renderVarianceChart() {
            const ctx = document.getElementById('variance-chart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: rtpResults.map((r, i) => `Test ${i+1}`),
                    datasets: [{
                        label: 'Variance from Expected',
                        data: rtpResults.map(r => r.variance),
                        backgroundColor: rtpResults.map(r => 
                            r.isCompliant ? 'rgba(39, 174, 96, 0.6)' : 'rgba(231, 76, 60, 0.6)'
                        ),
                        borderColor: rtpResults.map(r => 
                            r.isCompliant ? 'rgba(39, 174, 96, 1)' : 'rgba(231, 76, 60, 1)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            title: { display: true, text: 'Variance (%)' }
                        }
                    }
                }
            });
        }
        
        // Render results table
        function renderResultsTable() {
            const tbody = document.querySelector('#results-table tbody');
            tbody.innerHTML = '';
            
            rtpResults.forEach(result => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${result.gameId}</td>
                    <td>${result.expectedRTP.toFixed(2)}%</td>
                    <td>${result.actualRTP.toFixed(2)}%</td>
                    <td>${result.variance.toFixed(2)}%</td>
                    <td>${result.spinCount || 'N/A'}</td>
                    <td>
                        <span class="compliance-badge ${result.isCompliant ? 'compliance-pass' : 'compliance-fail'}">
                            ${result.isCompliant ? 'PASS' : 'FAIL'}
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Initialize the report
        document.addEventListener('DOMContentLoaded', () => {
            const summary = calculateSummary();
            renderSummary(summary);
            renderRTPDistribution();
            renderVarianceChart();
            renderResultsTable();
        });
    </script>
</body>
</html>